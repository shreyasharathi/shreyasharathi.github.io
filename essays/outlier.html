<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Credit Card Fraud Detection | Shreyas Harathi | Professional Portfolio">
    <meta name="description" content="">
    <meta name="image" content="https://github.com/shreyasharathi.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Shreyas Harathi | Professional Portfolio">
    <meta property="og:url" content="https://github.com/shreyasharathi/shreyasharathi.github.io/essays/outlier.html">
    <meta property="og:title" content="Credit Card Fraud Detection | Shreyas Harathi | Professional Portfolio">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://github.com/shreyasharathi.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/techfolio-theme/skyblue.css">
    <link rel="stylesheet" type="text/css" href="/css/rouge/github.css">
    <!-- Load MathJax if 'mathjax: true' is found in your _config.yml. -->
    
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML">
    </script>
    

    <title>Credit Card Fraud Detection | Shreyas Harathi | Professional Portfolio</title>
  </head>
  <body>
  <header class="navbar navbar-expand navbar-light bg-light bg-gradient border-bottom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Shreyas Harathi</a>
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <a class="nav-link" href="/#projects">Projects</a>
       <a class="nav-link" href="/#essays">Blog</a>
        <a class="nav-link" href="/resume.html">Resume</a>
      </ul>
    </div>
  </div>
</header>

<div class="container py-4">
  <h1 class="display-4">Credit Card Fraud Detection</h1>
  <span class="date">23 Nov 2023</span>
  <hr>
  <p>A classic example to demostrate anamoly and oultier detection is detection of credit card fraud. In the era of digital transactions, credit card fraud has become a prevalent issue. To tackle this problem, machine learning techniques can be employed for anomaly detection.</p>

<h2 id="the-dataset">THE DATASET</h2>

<p>The datasets contains transactions made by credit cards in September 2013 by european cardholders. This dataset presents transactions that occurred in two days, where we have 492 frauds out of 284,807 transactions.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="err">'</span><span class="n">creditcard</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="sc">','</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p><img class="img-fluid" src="../img/outlier/otl_dataset.png" width="40%" /></p>

<h2 id="eda">EDA</h2>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Fraud</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="err">'</span><span class="n">Class</span><span class="err">'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Valid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="err">'</span><span class="n">Class</span><span class="err">'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="n">outlier_fraction</span> <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">Fraud</span><span class="p">)</span><span class="o">/</span><span class="kt">float</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">Valid</span><span class="p">))</span>
<span class="n">print</span><span class="p">(</span><span class="s">"Fraud Cases : {}"</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">Fraud</span><span class="p">)))</span>
<span class="n">print</span><span class="p">(</span><span class="s">"Valid Cases : {}"</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">Valid</span><span class="p">)))</span>
<span class="n">print</span><span class="p">(</span><span class="n">outlier_fraction</span><span class="p">)</span>
</code></pre></div></div>
<p>After running this code, we can see that there are 492 fraud cases and they account for 0.0017 of the transactions.
Let’s explore the dataset with some visualizations before we apply our models. This will help us understand the problem better. Let us designate Fraud Transactions with ‘1’ and Valid transctions with ‘0’.
Let us generate a plot to see the Amount of Transactions per Class.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fraud</span><span class="p">.</span><span class="n">Amount</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="err">'</span><span class="n">Fraud</span><span class="err">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">normal</span><span class="p">.</span><span class="n">Amount</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="err">'</span><span class="n">Valid</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="err">'</span><span class="n">Amount</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="err">'</span><span class="n">Transactions</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">yscale</span><span class="p">(</span><span class="err">'</span><span class="n">log</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img class="img-fluid" src="../img/outlier/otl_plot1.png" width="40%" /></p>

<p>Let us generate a plot to visualize time of transaction vs amount per class</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fraud</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">fraud</span><span class="p">.</span><span class="n">Amount</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="err">'</span><span class="n">Fraud</span><span class="err">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">normal</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">normal</span><span class="p">.</span><span class="n">Amount</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="err">'</span><span class="n">Normal</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="err">'</span><span class="n">Time</span> <span class="p">(</span><span class="n">in</span> <span class="n">Seconds</span><span class="p">)</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="err">'</span><span class="n">Amount</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img class="img-fluid" src="../img/outlier/otl_plot2.png" width="40%" /></p>

<p>Let us generate crrelation of each feature.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cor1</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">cor1</span><span class="p">.</span><span class="n">index</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">g</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tfeatures</span><span class="p">].</span><span class="n">corr</span><span class="p">(),</span><span class="n">annot</span><span class="o">=</span><span class="n">True</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">"RdYlGn"</span><span class="p">)</span>
</code></pre></div></div>
<p><img class="img-fluid" src="../img/outlier/otl_heatmap.png" width="40%" /></p>

<h2 id="ml-models">ML Models</h2>
<h3 id="1-isolation-forest">1. Isolation Forest</h3>
<p>The key idea behind Isolation Forest is that anomalies are usually the data points that are easiest to isolate or separate from the normal data. Specifically, an isolation forest uses an ensemble of decision trees, each built in a randomized fashion to isolate various instances in the data. When building each tree, the Isolation Forest algorithm randomly selects a feature and then randomly selects a split value between the maximum and minimum values of that feature. The recursively partitions or splits the data along those lines.</p>

<h3 id="2-lof">2. LOF</h3>
<p>LOF captures the degree of outliers by measuring the local deviation of a point compared to its neighbors. Points that stand out with respect to their local neighborhoods will have much higher LOF scores, marking them as potential anomalies. A key advantage of LOF is it does not require any assumptions about the underlying data distribution or definitions of global parameters that define outliers. It relies entirely on local neighborhoods.</p>

<p>The code is as follows:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Isolation Forest"</span><span class="o">:</span><span class="n">IsolationForest</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="n">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> 
                                       <span class="n">contamination</span><span class="o">=</span><span class="n">outlier_fraction</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="s">"Local Outlier Factor"</span><span class="o">:</span><span class="n">LocalOutlierFactor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="err">'</span><span class="k">auto</span><span class="err">'</span><span class="p">,</span> 
                                              <span class="n">leaf_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="err">'</span><span class="n">minkowski</span><span class="err">'</span><span class="p">,</span>
                                              <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">metric_params</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="n">outlier_fraction</span><span class="p">)</span>
   
<span class="p">}</span>
</code></pre></div></div>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_outliers</span> <span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">Fraud</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">clf_name</span><span class="p">,</span><span class="n">clf</span><span class="p">)</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">classifiers</span><span class="p">.</span><span class="n">items</span><span class="p">())</span><span class="o">:</span>
    <span class="cp">#Fit the data and tag outliers
</span>    <span class="k">if</span> <span class="n">clf_name</span> <span class="o">==</span> <span class="s">"Local Outlier Factor"</span><span class="o">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">scores_prediction</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">negative_outlier_factor_</span>
    <span class="k">else</span><span class="o">:</span>    
        <span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">scores_prediction</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="cp">#Reshape the prediction values to 0 for Valid transactions , 1 for Fraud transactions
</span>    <span class="n">y_pred</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y_pred</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">!=</span> <span class="n">Y</span><span class="p">).</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div></div>
<p>Our final output is:</p>

<p><img class="img-fluid" src="../img/outlier/otl_output.png" width="40%" /></p>

<p>In this plot, each point on the x-axis represents a transaction, and the y-axis represents the outlier score. The color of the marker indicates whether the transaction was classified as a valid (blue) or fraudulent (red) transaction.</p>

<p><img class="img-fluid" src="../img/outlier/otl_final.png" width="40%" /></p>

<h2 id="conclusion">Conclusion</h2>
<p>Isolation Forest has an accuracy score of 0.997 and LOF has an accuracy score of 0.996. The key point of difference is that fraud detection is 31% in isolation forest whereas for LOF it is just 5%. Hence for our purposes and this dataset, isolation forest would be more useful.</p>

<p>Source: <a href="https://github.com/shreyasharathi/shreyasharathi.github.io/blob/main/Notebooks/outlier.ipynb"><i class="large github icon "></i>outlier</a></p>

</div>

<footer class="navbar navbar-expand navbar-light bg-light bg-gradient border-top">
  <div class="container-fluid">
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
       <!-- <small><a class="nav-link" href="https://techfolios.github.io">Made with Techfolios</a></small> -->
      </ul>
    </div>
  </div>
</footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Exploring Housing Data and Regression Models | Shreyas Harathi | Professional Portfolio">
    <meta name="description" content="">
    <meta name="image" content="https://github.com/shreyasharathi.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Shreyas Harathi | Professional Portfolio">
    <meta property="og:url" content="https://github.com/shreyasharathi/shreyasharathi.github.io/essays/nonlinear.html">
    <meta property="og:title" content="Exploring Housing Data and Regression Models | Shreyas Harathi | Professional Portfolio">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://github.com/shreyasharathi.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/techfolio-theme/skyblue.css">
    <link rel="stylesheet" type="text/css" href="/css/rouge/github.css">
    <!-- Load MathJax if 'mathjax: true' is found in your _config.yml. -->
    
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML">
    </script>
    

    <title>Exploring Housing Data and Regression Models | Shreyas Harathi | Professional Portfolio</title>
  </head>
  <body>
  <header class="navbar navbar-expand navbar-light bg-light bg-gradient border-bottom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Shreyas Harathi</a>
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <a class="nav-link" href="/#projects">Projects</a>
       <a class="nav-link" href="/#essays">Blog</a>
        <a class="nav-link" href="/resume.html">Resume</a>
      </ul>
    </div>
  </div>
</header>

<div class="container py-4">
  <h1 class="display-4">Exploring Housing Data and Regression Models</h1>
  <span class="date">05 Nov 2023</span>
  <hr>
  <p>In this blog post, we’ll walk through housing data and apply regression models to predict median house values. Nonlinear regression is a statistical method used to model the relationship between variables through nonlinear functions, allowing for more flexible and complex representations than linear regression. It involves estimating parameters that minimize the difference between observed and predicted values, often requiring optimization techniques.</p>

<h2 id="the-dataset">The Dataset</h2>

<p>Our dataset contains 20640 observations and 9 features and 1 target variable(median_house_value). Let’s load the dataset.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># Load the data
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"housing.csv"</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div></div>

<p><img class="img-fluid" src="../img/nonlinear/nlr_dataset.png" width="40%" /></p>

<h2 id="pre-processing">Pre Processing</h2>
<p>To gain insights into the dataset, lets preprocess the data by dropping unnecessary columns and create a scatter plot to visualize the relationship between median income and median house value.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># Drop irrelevant columns and create scatter plot
</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"housing_median_age"</span><span class="p">,</span> <span class="s">"households"</span><span class="p">,</span> <span class="s">"total_bedrooms"</span><span class="p">,</span> <span class="s">"longitude"</span><span class="p">,</span> <span class="s">"latitude"</span><span class="p">,</span> <span class="s">"total_rooms"</span><span class="p">,</span> <span class="s">"population"</span><span class="p">,</span> <span class="s">"ocean_proximity"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">"median_house_value"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"median_house_value"</span><span class="p">]</span>

<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="err">'</span><span class="n">Scatter</span> <span class="n">plot</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="err">'</span><span class="n">median_income</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="err">'</span><span class="n">median_house_value</span><span class="err">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ml-models">ML Models</h2>
<h3 id="1linear-regression">1.Linear Regression</h3>
<p>Now, it’s time to build our linear regression model. We’ll split the data into training and testing sets, create the model, and fit it to the training data.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># Model initialization
</span><span class="n">regression_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="cp"># Fit the data(train the model)
</span><span class="n">regression_model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="cp"># Predict
</span><span class="n">y_predicted</span> <span class="o">=</span> <span class="n">regression_model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="cp"># model evaluation
</span><span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">))</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">)</span>
</code></pre></div></div>
<p>We obtain a R2 score of 0.446.</p>

<h4 id="residual-plot-from-linear-regression">Residual plot from linear regression</h4>
<p>The residuals exhibit a clear non straight line, which provides a strong indication of non-linearity in the data</p>

<p>This makes us to do somethhing more to find better fit of the model.</p>

<p><img class="img-fluid" src="../img/nonlinear/nlr_residual1.png" width="40%" /></p>

<h3 id="2-applying-transform">2. Applying transform</h3>
<p>We obtain a tranform by first running</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> 
<span class="n">tf1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>
<p>We then fit the model by running:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regression_model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="cp"># Predict
</span><span class="n">y_predicted</span> <span class="o">=</span> <span class="n">regression_model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tf1</span><span class="p">)</span>

<span class="cp"># model evaluation
</span><span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">))</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">)</span>
</code></pre></div></div>
<p>The obtained R2 score is 0.4385 which is worse than the previous model.</p>

<p>Now we can obtain the residual plot by:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># Assuming y_predicted and y_test are defined and are numpy arrays or similar data structures that support arithmetic operations
</span><span class="n">residual</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_predicted</span>

<span class="cp"># Corrected call to residplot
</span><span class="n">sns</span><span class="p">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="err">'</span><span class="n">alpha</span><span class="err">'</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="err">'</span><span class="n">color</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">red</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">lw</span><span class="err">'</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="err">'</span><span class="n">alpha</span><span class="err">'</span><span class="o">:</span> <span class="mf">0.8</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img class="img-fluid" src="../img/nonlinear/nlr_residual2.png" width="40%" /></p>

<p>Residual plot for the transformed linear regression is more zigzag than the simple linear regression. This residual plot suggest that transformation makes the relationship more non- linear in nature.</p>

<h3 id="model-3">Model 3</h3>
<p>We will now attempt a polynomial regression model.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">poly_reg</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_reg</span><span class="p">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pol_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">pol_reg</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">def</span> <span class="n">viz_polymonial</span><span class="p">()</span><span class="o">:</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">pol_reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">poly_reg</span><span class="p">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="err">'</span><span class="n">median_income</span><span class="err">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="err">'</span><span class="n">median_house_value</span><span class="err">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
<span class="n">viz_polymonial</span><span class="p">()</span>
</code></pre></div></div>
<p>we get the following plot.</p>

<p>Evaluating the model :</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_p</span> <span class="o">=</span> <span class="n">poly_reg</span><span class="p">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_predicted</span> <span class="o">=</span> <span class="n">pol_reg</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_p</span><span class="p">)</span>

<span class="cp"># model evaluation
</span><span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">))</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">)</span>
</code></pre></div></div>
<p>We end up with a R2 of 0.449, which is our best score yet. now we run:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># Assuming y_predicted and y_test are defined and are numpy arrays or similar data structures that support arithmetic operations
</span><span class="n">residual</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_predicted</span>

<span class="cp"># Corrected call to residplot
</span><span class="n">sns</span><span class="p">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="err">'</span><span class="n">alpha</span><span class="err">'</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="err">'</span><span class="n">color</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">red</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">lw</span><span class="err">'</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="err">'</span><span class="n">alpha</span><span class="err">'</span><span class="o">:</span> <span class="mf">0.8</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img class="img-fluid" src="../img/nonlinear/nlr_residual3.png" width="40%" /></p>

<h2 id="conclusion">Conclusion</h2>
<p>Model 3 has the best R2 score but it is also far more complex than model 1. This trade off must be considered while selecting a suitable model.</p>

<p>Source: <a href="https://github.com/shreyasharathi/shreyasharathi.github.io/blob/main/Notebooks/non-linear-regression.ipynb"><i class="large github icon "></i>non-linear-regression</a></p>

</div>

<footer class="navbar navbar-expand navbar-light bg-light bg-gradient border-top">
  <div class="container-fluid">
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
       <!-- <small><a class="nav-link" href="https://techfolios.github.io">Made with Techfolios</a></small> -->
      </ul>
    </div>
  </div>
</footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  </body>
</html>
